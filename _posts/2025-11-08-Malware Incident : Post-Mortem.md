---
title: End-to-End Malware Incident Response in Embedded & IoT Systems
author: Mouna
date: 2025-11-08 10:00:00 +0800
categories: [1 Project-- Malware Incident Post-Mortem]
---
# Introduction
This project documents a full "post-mortem" analysis of compromised embedded Linux environment, covering network, memory, and storage forensics, as well as static and dynamic malware analysis. 

The initial goal was to analyze the Mirai botnet, a well-known IoT malware family, in a controlled lab environment.
To have a realistic deployment scenario, I setup a lab on VirtualBox that contains:
- an **IoT Gateway VM**: OpenWrt x86 (32bit, i686), compromised embedded device.
- a **Fake C2 VM**: Ubuntu Server, Hosting a controlled listener for outbound traffic.

> Disclaimer:
> A Mirai-based IoT malware variant was compiled from publicly available source code with propagation features disabled to focus on post-compromise behavior and forensic analysis. Source: https://github.com/jgamblin/Mirai-Source-Code
{: .prompt-warning }
    -------Lab VM pictures-------

During testing, the Mirai ELF32 binary consistently failed to execute on the OpenWrt environment (segmentation faults and self-deletion).
These issues are likely related to ABI mismatches, libc differences, and Mirai’s built-in self-protection mechanisms.

Rather than discarding the project, the analysis proceeds by sourcing artifacts separately from sources available online (e.g. HackTheBox), instead of using artifacts from one specific incident to illustrate the different steps of forensic analysis, the methodology and investigation workflow will stay the same.

In parallel, I extracted the Mirai binary and transferred it to a Ghidra-equipped VM to analyse and investigate the root casues of the failure to execute.

>Upcoming article:
Embedded malware failure analysis: reverse engineering a Mirai ELF32 binary that segfaults and self-deletes on OpenWrt
{: .prompt-warning }

# Methodology
The methodology applied throughout this project to analyze artifacts from a compromised system is as follows:

## Network Observation
The goal is to monitor active network connections (and identify potential Command-and-control behavior) and take note of:
- Reccurent IP addresses/ external hostnames
- Periodicity of outbound traffic
Detailed analysis covered in: **"Malware Incident: Network Observations"**

## Memory Acquisition
Live memory analysis aims to extract runtime artifacts such a:
- Running processes
- Suspicious memory regions and mappings
Techniques and findings are detailed in: **"Malware Incident: Memory Forensics"**

## Storage Analysis
Storage analysis targets persistence and on-disk artifacts, including:
- Init scripts/ startup mechanisms
- Recentlty modified files
- New binaries/ scripts
See: **"Malware Incident: Storage Analysis"**

## Artifacts
At the end of the acquisition phase, we expect to have:
- Process memory artifacts  
- Network traffic captures  
- File system metadata and timelines 

Following is a general workflow that tries to sum up all the phases that will be covered throughout the submodules.

/*
## Investigation Workflow

The investigation follows a structured workflow designed to reflect real-world incident response on embedded Linux systems, where visibility is limited and artifacts are often incomplete or missing.

1. **Initial Triage**
   - Identify abnormal system behavior (CPU usage, network activity)
   - Establish a preliminary compromise hypothesis

2. **Live Data Acquisition**
   - Capture active network traffic
   - Enumerate running processes and runtime state
   - Collect volatile artifacts where possible

3. **Post-Execution Collection**
   - Extract process-level memory artifacts
   - Gather file system metadata and persistence indicators
   - Preserve relevant logs and configuration files

4. **Offline Analysis**
   - Network traffic inspection (PCAP analysis)
   - Memory artifact analysis
   - File system timeline reconstruction

5. **Malware Analysis**
   - Static reverse engineering of recovered binaries
   - Identification of IOCs and behavioral indicators
   - Correlation with observed runtime artifacts

Each phase feeds into the next, allowing partial or degraded data to still contribute to the overall incident understanding—an especially common scenario in embedded and IoT environments.
*/